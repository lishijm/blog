# 230807-0819

## 所学所做

1. 学习某型无人机起落架可控制的电子电气器件：

   * 切换正负极控制：前起落架电推杆
   * PWM波控制：前起落架舱门舵机THL798H,前起落架转向舵机X30-12-150；
   * 485串口命令控制：主起落架刹车飞特舵机
   * 板间通信：CAN总线
   * 前起落架与飞控通信：232

   信号框架：

   ```mermaid
   graph LR
   A(飞控)-->|RS232|B(前起落架控制板)
   B --> |CAN总线|C(后起落架控制板)
   B-->|引脚正负电平 引脚使能失能 电源芯片|H(电推杆)
   B-->|PWM|I(左舱门舵机)
   B-->|PWM|J(右舱门舵机)
   B-->|PWM|K(转向舵机)
   B-->|电平读取|L(轮载信号)
   C -->|485总线| D(左轮飞特舵机)
   C -->|485总线| E(右轮飞特舵机)
   C -->|脉冲定时器中断| F(左轮脉冲信号)
   C -->|脉冲定时器中断| G(右轮脉冲信号)
   ```

2. 舵机控制：舵机为自带控制板的伺服电机系统：

   * 使用的前起落架舵机接收0\~100°（PWM波1000\~2000微秒的高电平控制信号），舵机控制板通过PID自主决定输入电流大小。
   * 使用的后起落架刹车舵机接收485串口总线信号：通过写舵机控制板串口命令，控制舵机转向角度，输出最高扭矩参数等。

3. 后起落架防抱死机制：采用一个周期内1单位时间不输出扭矩，5\~6时间单位输出扭矩，单位时间20\~23ms。

4. 后起落架刹车扭矩标定：

   * 静态扭矩标定：使用飞特舵机调试工具，设置刹车舵机输出扭矩千分比，测定刹车扭矩千克数，多次改变刹车扭矩输出千分比，记录对应数据，使用cftool或者excel拟合出x=扭矩千分比，y=刹车扭矩千克数的曲线，一般为线性一阶曲线，线性不好时可以使用二阶进行拟合，最后将拟合出的扭矩曲线公式系数写入程序中。目前版本曲线分辨率为0.25KG，即100%刹车力度为25KG。
   * 动态扭矩标定：模拟飞控发送刹车百分比，测定左右轮动态刹车扭矩，以左右轮尽量一致为佳。

## 计划

* 写出25型无人机起落架收放程序部分
* 与王师傅沟通CAN总线通信部分板间通信拓扑结构，CAN总线协议和如何数据帧的处理。
