# 浅谈ARM处理器架构与ARM指令集

[toc]

## ARM汇编指令格式

```assembly
<指令>{<>}
```



## ARM汇编指令整理

| 种类         | 指令 | 含义                                                         |
| ------------ | ---- | ------------------------------------------------------------ |
| 数据传输指令 | MOV  | MOV Rd,Rn；将第一操作寄存器的数据移到目标指令集Rd            |
|              | MVN  | MVN Rd,Rn；将第一操作寄存器的数据取反后移到目标指令集Rd      |
| 比较指令     | CMP  | CMP Rd,Rn；减法比较Rd-Rn，更新CPSR                           |
|              | CMN  | CMN Rd,Rn；加法比较Rd+Rn，更新CPSR                           |
|              | TST  | TST Rd,Rn；位测试Rd&Rn，更新CPSR                             |
|              | TEQ  | TEQ Rd,Rn；相等测试Rd^Rn,更新CPSR                            |
| 加法指令     | ADD  | ADD Rd,Rn,shifted_opt；Rd=Rn+shifted_opt                     |
|              | ADC  | ADC Rd,Rn,shifted_opt；Rd=Rn+Rn+C(CPSR)；加法进位指令        |
| 减法指令     | SUB  | SUB Rd,Rn,shifted_opt；Rd=Rn-shifted_opt                     |
|              | SBC  | SUB Rd,Rn,shifted_opt；Rd=Rn-shifted_opt-C(CPSR)；减法借位指令 |
|              | RSB  | RSB Rd,Rn,shifted_opt；Rd=shifted_opt-Rn；反减               |
|              | RSC  | RSB,Rd,Rn,shifted_opt;Rd=shifted_opt-Rn-C(CPSR)；反减借位    |
| 位运算指令   | AND  | AND Rd,Rn,shifted_opt；Rd=Rn&shifted_opt                     |
|              | ORR  | ORR Rd,Rn,shifted_opt；Rd=Rn\|shifted_opt                    |
|              | EOR  | EOR Rd,Rn,shifted_opt；Rd=Rn^shifted_opt；相同为零不同为一   |
|              | BIC  | EOR Rd,Rn,shifted_opt；取二进制shifter_opt为1的位将Rn对应的位写零，结果导入到Rd |

## 条件码及其助记符(conditional execution)

| 条件码 | 助记符 | 寄存器标识位条件 | 含义               |
| ------ | ------ | ---------------- | ------------------ |
| 0000   | EQ     | Z=1              | 相等               |
| 0001   | NE     | Z=0              | 不相等             |
| 0010   | CS     | C=1              | 无符号数大于或等于 |
| 0011   | CC     | C=0              | 无符号数小于       |
| 0100   | MI     | N=1              | 负数               |
| 0101   | PL     | N=0              | 正数或零           |
| 0110   | VS     | V=1              | 溢出               |
| 0111   | VC     | V=0              | 未溢出             |
| 1000   | HI     | C=1&&Z=1         | 无符号数大于       |
| 1001   | LS     | C=0\|\|Z=1       | 无符号数小于或等于 |
| 1010   | GE     | N=V              | 带符号数大于或等于 |
| 1011   | LT     | N!=V             | 带符号数小于       |
| 1100   | GT     | Z=0&&N=V         | 带符号数大于       |
| 1101   | LE     | Z=1\|\|N!=V      | 带符号数小于或等于 |
| 1110   | AL     | Any              | Always             |

## 示例代码

```assembly
MOV R1,#0X01
RSB R0,R1,#0XFF @反减
```
结果：

| 寄存器 | 运行前     | 运行后     |
| ------ | ---------- | ---------- |
| R0     | 0x00000000 | 0x000000FE |
| R1     | 0x00000000 | 0x00000001 |

```assembly
MRS R0,CPSR
BIC R0,#0X3 @按位清零
MSR CPSR,R0
NOP
NOP
```


| 寄存器   | 运行前     | 第一步后   | 第二步后   | 第三步     |
| -------- | ---------- | ---------- | ---------- | ---------- |
| R0       | 0x00000000 | 0x000000D3 | 0x000000D0 | 0X000000D0 |
| CPSR     | 0x000000D3 | 0x000000D3 | 0x000000D3 | 0x000000D0 |
| 模式状态 | SVS        | SVS        | SVS        | USER       |

```assembly
MRS R0,CPSR
BIC R0,#0X3 @按位清零
MSR CPSR,R0
NOP
NOP
```

|      |      |      |
| ---- | ---- | ---- |
|      |      |      |
|      |      |      |
|      |      |      |



```assembly
MOV R0,#0X2
MOV R1,#0X1
MOV R2,#0X1
MOV R3,#0XFFFFFFFF
SUB R5,R1,R3
SBC R4,R0,R2  @借位
NOP
NOP
```

```assembly
MOV R0,#0X1
MOV R1,#0XFFFFFFFF
MOV R2,#0X1
MOV R3,#0X1
ADDS R5,R3,R1
ADC R4,R0,R2   @进位
NOP
NOP
```

```assembly
MOV R0,#5
MOV R1,#3
CMP R0,R1      @ CPSR
SUBHI R0,R0,R1 @ R0<-(R0-R1)
SUBLS R1,R1,R0 
```

```assembly
@compare command
MOV R0,#2
CMP R0,#2
CMP R0,#3
MOV R0,#2
CMN R0,#-2
MOV R0,#16
TST R0,#(1<<4)
MOV R0,#234
TEQ R0,#234
```

```assembly
@transmit commmand
MOV R0,#1
MVN R0,#1
```

