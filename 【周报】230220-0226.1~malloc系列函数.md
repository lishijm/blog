# 【周报】230220-0226.1~malloc系列函数

[toc]

## malloc

malloc函数可在堆中自动寻找适当的位置，申请一块指定字节大小的空间。

```c
#include <stdlib.h>

void *malloc(size_t size);
//开辟一块堆空间，size变量指所开辟空间字节大小

void free(void *ptr);
//释放所开辟空间。malloc需要手动释放
```

### 使用malloc与auto的区别

|malloc|auto|
|-|-
|变量存储在堆中|变量存储在栈中
|空间手动申请|空间编译器自动申请
|空间手动释放|空间自动释放
|会产生内存泄漏|不会产生内存泄漏
|32bitOS有4GB的虚拟内存空间|取决于编译器，一般1~2MB
|有碎片问题|没有碎片问题
|向内存地址增加的方向扩展|向内存地址减小的方向扩展
|调用效率低|调用效率高
|可以分配动态数组|无法分配动态数组

### malloc的使用

因为malloc函数原型是void *数据类型，所以可以通过强制转换，变为其他数据类型。
例如需要声明int类型的数组那么就可以声明一个int \*的指针：

```c
int *p=(int *)malloc(sizeof(int_size)*n)//即为n个int元素数组开辟空间
```

初始化malloc空间需要使用memset函数：

```c
#include<string.h>

void *memset(void *s, int c, size_t n);
//(malloc首地址,需要填入的初始化值,需要初始化的字节量)
```

malloc函数开辟的空间需要手动使用free函数释放：

```c
void free(void *ptr);//(需要释放的空间首地址)
```

### 内存池，内存泄漏和内存溢出

内存池：因为多次使用malloc系列函数申请/改动空间会在堆中造成碎片问题，所以引入内存池（memory pool），将申请的空间的地址放进列表里面，当去申请空间的时候，直接给列表里面的空间地址，释放完之后，将空间地址放回列表里面。

内存泄漏：申请的堆空间在使用结束后不释放。

内存溢出：堆空间未被释放的内存过多，新申请的堆空间大小超过剩余堆空间大小。
